index.html
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Membros — UP RP</title>
<style>
  body{font-family:Inter,system-ui,Arial;background:#060b18;color:#e9f0ff;padding:20px;}
  .wrap{max-width:980px;margin:0 auto;}
  input,button,textarea,select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0c152b;color:inherit;}
  button{cursor:pointer;background:#0099ff;font-weight:600;}
  button:hover{background:#00b7ff;}
  .members{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:12px;}
  .card{background:#0e1a33;padding:14px;border-radius:12px;box-shadow:0 0 10px #0004;}
  .muted{color:#aabbcc;font-size:13px;}
  .badge{background:#00ff88;color:#041017;padding:4px 8px;border-radius:999px;font-weight:800;font-size:12px;}
  hr{border:0;border-top:1px solid #1a2a44;margin:20px 0;}
  .hidden{display:none;}
</style>
</head>

<body>
<div class="wrap">
<h1>Membros — UP RP</h1>
<p class="muted">Gerenciamento de jogadores, IDs e cargos. Seguro e conectado ao banco Supabase.</p>

<!-- LOGIN / REGISTRO -->
<div id="authBox">
  <input id="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Senha" />
  <button id="signupBtn">Registrar</button>
  <button id="signinBtn">Entrar</button>
</div>

<button id="logoutBtn" class="hidden">Sair</button>

<!-- PERFIL DO USUÁRIO -->
<div id="profileBox" class="hidden">
  <h2>Meu Perfil</h2>
  <p class="muted" id="myPublicId"></p>

  <input id="displayName" placeholder="Nome público" />
  <input id="username" placeholder="username único" />
  <input id="avatar" placeholder="URL da foto" />
  <textarea id="bio" rows="3" placeholder="Bio"></textarea>

  <button id="saveProfile">Salvar Perfil</button>
</div>

<hr/>

<!-- FILTROS -->
<h2>Lista de Membros</h2>
<div style="display:flex;gap:10px;align-items:center;">
  <input id="search" placeholder="Pesquisar nome ou username" style="flex:1;" />
  <select id="filterRole">
    <option value="">Todos os cargos</option>
  </select>
  <button id="refresh">Atualizar</button>
</div>

<div id="membersList" class="members"></div>

<hr/>

<!-- PAINEL STAFF -->
<div id="staffPanel" class="hidden">
  <h2>Painel Staff</h2>
  <p class="muted">Somente Moderadores, Staff, Admin e SuperAdmin veem isso.</p>
  <div id="staffActions"></div>
</div>

</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = supabaseJs.createClient(
  "https://ekiaqwvmemwazinytrws.supabase.co",
  "sb_publishable_TpK5G8o2V7-CXieaIeuK_wuvt4tWO"
);

// ELEMENTOS
const emailEl = document.getElementById('email');
const passEl = document.getElementById('password');
const signupBtn = document.getElementById('signupBtn');
const signinBtn = document.getElementById('signinBtn');
const logoutBtn = document.getElementById('logoutBtn');
const profileBox = document.getElementById('profileBox');
const displayNameEl = document.getElementById('displayName');
const usernameEl = document.getElementById('username');
const avatarEl = document.getElementById('avatar');
const bioEl = document.getElementById('bio');
const saveProfile = document.getElementById('saveProfile');
const myPublicIdEl = document.getElementById('myPublicId');
const membersList = document.getElementById('membersList');
const searchEl = document.getElementById('search');
const filterRole = document.getElementById('filterRole');
const staffPanel = document.getElementById('staffPanel');
const staffActions = document.getElementById('staffActions');

// REGISTRO
signupBtn.onclick = async () => {
  const { error } = await supabase.auth.signUp({
    email: emailEl.value,
    password: passEl.value
  });
  if(error) return alert(error.message);
  alert("Conta criada! Agora faça login.");
};

// LOGIN
signinBtn.onclick = async () => {
  const { error } = await supabase.auth.signInWithPassword({
    email: emailEl.value,
    password: passEl.value
  });
  if(error) return alert(error.message);
  initUser();
};

// LOGOUT
logoutBtn.onclick = async () => {
  await supabase.auth.signOut();
  location.reload();
};

// APÓS LOGIN
async function initUser(){
  const { data } = await supabase.auth.getUser();
  if(!data.user) return;

  logoutBtn.classList.remove("hidden");
  signupBtn.classList.add("hidden");
  signinBtn.classList.add("hidden");

  let { data: row } = await supabase.from("members")
    .select("*")
    .eq("id", data.user.id)
    .single();

  // cria perfil se não existir
  if(!row){
    await supabase.from("members").insert({
      id: data.user.id,
      username: data.user.email.split("@")[0],
      display_name: data.user.email.split("@")[0]
    });

    let r2 = await supabase.from("members")
      .select("*")
      .eq("id", data.user.id)
      .single();
    row = r2.data;
  }

  fillProfile(row);
  profileBox.classList.remove("hidden");

  checkStaff(row.role);
  loadMembers();
}

// MOSTRAR PERFIL
function fillProfile(row){
  displayNameEl.value = row.display_name || "";
  usernameEl.value = row.username || "";
  avatarEl.value = row.avatar_url || "";
  bioEl.value = row.bio || "";
  myPublicIdEl.innerHTML = `ID Público: <b>${row.public_id}</b>`;
}

// SALVAR PERFIL
saveProfile.onclick = async () => {
  const { data: userData } = await supabase.auth.getUser();
  const { error } = await supabase.from("members").update({
    display_name: displayNameEl.value,
    username: usernameEl.value,
    avatar_url: avatarEl.value,
    bio: bioEl.value
  }).eq("id", userData.user.id);

  if(error) return alert(error.message);
  alert("Perfil atualizado!");
  loadMembers();
};

// CARREGAR LISTA
async function loadMembers(){
  let q = supabase.from("members").select("*").order("public_id");

  if(searchEl.value){
    q = q.or(`username.ilike.%${searchEl.value}%,display_name.ilike.%${searchEl.value}%`);
  }

  if(filterRole.value){
    q = q.eq("role", filterRole.value);
  }

  const { data, error } = await q;
  if(error) return;

  renderMembers(data);
  updateRoleFilter(data);
}

// RENDERIZAR CARDS
function renderMembers(list){
  membersList.innerHTML = "";
  list.forEach(m => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <strong>${m.display_name}</strong> <span class="muted">#${m.public_id}</span><br>
      <span class="muted">@${m.username}</span><br>
      <span class="badge">${m.role}</span>
      <p class="muted">${m.bio || ""}</p>
      <div id="actions-${m.id}"></div>
    `;
    membersList.appendChild(div);
    renderStaffActions(m);
  });
}

// STAFF
function checkStaff(role){
  if(["mod","staff","admin","superadmin"].includes(role)){
    staffPanel.classList.remove("hidden");
  }
}

async function renderStaffActions(member){
  const session = (await supabase.auth.getSession()).data.session;
  if(!session) return;

  const { data: me } = await supabase
    .from("members")
    .select("role")
    .eq("id", session.user.id)
    .single();

  if(!["mod","staff","admin","superadmin"].includes(me.role)) return;

  const box = document.getElementById("actions-"+member.id);
  box.innerHTML = `
    <button onclick="banUser('${member.id}')">Banir</button>
    <select onchange="changeRole('${member.id}', this.value)">
      <option value="">cargo...</option>
      <option value="player">player</option>
      <option value="member">member</option>
      <option value="mod">mod</option>
      <option value="staff">staff</option>
      <option value="admin">admin</option>
    </select>
  `;
}

// BANIR
async function banUser(id){
  if(!confirm("Banir usuário?")) return;
  await supabase.from("members").delete().eq("id", id);
  loadMembers();
}

// MUDAR CARGO
async function changeRole(id, role){
  await supabase.from("members").update({ role }).eq("id", id);
  loadMembers();
}

// FILTROS
searchEl.oninput = ()=>loadMembers();
filterRole.onchange = ()=>loadMembers();
document.getElementById('refresh').onclick = ()=>loadMembers();

// AUTOLOGIN
(async ()=>{
  const s = (await supabase.auth.getSession()).data.session;
  if(s) initUser();
})();
</script>
</body>
</html>


